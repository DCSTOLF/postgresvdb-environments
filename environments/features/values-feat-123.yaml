environment: feature
featureBranch: "feat-123"

vdb:
  name: "feat-123-vdb"
  database:
    name: "feat_123_app"
    user: "feat_123_user"
    password: "feat_123_password"
  
  resources:
    requests:
      memory: "2Gi"
      cpu: "1"
    limits:
      memory: "4Gi"
      cpu: "2"
  
  hooks:
    - name: "init-feat-schema"
      stage: "post-create"
      database: "feat_123_app"
      script: |
        -- Create feature-specific schemas
        CREATE SCHEMA IF NOT EXISTS feat_123_experimental;
        CREATE SCHEMA IF NOT EXISTS feat_123_testing;
        
        -- Create experimental data table
        CREATE TABLE IF NOT EXISTS feat_123_experimental.experimental_data (
          id SERIAL PRIMARY KEY,
          feature_name VARCHAR(100) NOT NULL,
          feature_data JSONB,
          created_at TIMESTAMP DEFAULT NOW(),
          updated_at TIMESTAMP DEFAULT NOW(),
          created_by VARCHAR(100),
          status VARCHAR(50) DEFAULT 'active'
        );
        
        -- Create feature flag table
        CREATE TABLE IF NOT EXISTS feat_123_experimental.feature_flags (
          flag_id SERIAL PRIMARY KEY,
          flag_name VARCHAR(100) UNIQUE NOT NULL,
          enabled BOOLEAN DEFAULT false,
          description TEXT,
          created_at TIMESTAMP DEFAULT NOW()
        );
        
        -- Create test data table
        CREATE TABLE IF NOT EXISTS feat_123_testing.test_data (
          test_id SERIAL PRIMARY KEY,
          test_case VARCHAR(255) NOT NULL,
          input_data JSONB,
          expected_output JSONB,
          actual_output JSONB,
          passed BOOLEAN,
          executed_at TIMESTAMP DEFAULT NOW()
        );
        
        -- Create indexes
        CREATE INDEX IF NOT EXISTS idx_experimental_data_feature ON feat_123_experimental.experimental_data(feature_name);
        CREATE INDEX IF NOT EXISTS idx_experimental_data_status ON feat_123_experimental.experimental_data(status);
        CREATE INDEX IF NOT EXISTS idx_test_data_case ON feat_123_testing.test_data(test_case);
        
        -- Grant permissions
        GRANT ALL ON SCHEMA feat_123_experimental TO feat_123_user;
        GRANT ALL ON SCHEMA feat_123_testing TO feat_123_user;
        GRANT ALL ON ALL TABLES IN SCHEMA feat_123_experimental TO feat_123_user;
        GRANT ALL ON ALL TABLES IN SCHEMA feat_123_testing TO feat_123_user;
        GRANT ALL ON ALL SEQUENCES IN SCHEMA feat_123_experimental TO feat_123_user;
        GRANT ALL ON ALL SEQUENCES IN SCHEMA feat_123_testing TO feat_123_user;
        
        -- Insert initial feature flags
        INSERT INTO feat_123_experimental.feature_flags (flag_name, enabled, description)
        VALUES 
          ('feat_123_enabled', true, 'Master feature flag for feat-123'),
          ('feat_123_debug_mode', false, 'Enable debug logging for feat-123')
        ON CONFLICT (flag_name) DO NOTHING;
        
        -- Insert sample data
        INSERT INTO feat_123_experimental.experimental_data (feature_name, feature_data, created_by)
        VALUES ('feat-123-init', '{"status": "initialized", "version": "0.1.0"}'::jsonb, 'system');

# Monitoring for feature branch
monitoring:
  enabled: true
  serviceMonitor:
    enabled: false

# Service configuration
service:
  type: ClusterIP
  annotations:
    feature.branch: "feat-123"
    feature.expires: "30d"
